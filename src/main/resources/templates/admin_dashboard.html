<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>管理者ダッシュボード</title>
  <link rel="stylesheet" th:href="@{/css/style.css}">
</head>

<body>

<div th:replace="fragments/header :: appHeader('管理者ダッシュボード')"></div>

<div th:replace="fragments/layout :: page(~{::content})">

  <th:block th:fragment="content">
    <div class="card">

      <h2>全社員の勤怠一覧</h2>

      <form th:action="@{/admin/dashboard}" method="get" class="admin-filter">
        <div class="filter-row">

          <div class="filter-item">
            <label>社員</label>
            <select name="userId">
              <option value="" th:selected="${cond == null or cond.userId == null}">全員</option>
              <option th:each="u : ${users}"
                      th:value="${u.id}"
                      th:text="${u.username}"
                      th:selected="${cond != null and cond.userId != null and cond.userId.equals(u.id)}">
              </option>
            </select>
          </div>

          <div class="filter-item">
            <label>開始日</label>
            <input type="date" name="from" th:value="${cond != null ? cond.from : ''}">
          </div>

          <div class="filter-item">
            <label>終了日</label>
            <input type="date" name="to" th:value="${cond != null ? cond.to : ''}">
          </div>

          <div class="filter-actions">
            <button type="submit" class="button secondary">検索</button>

            <button type="submit"
                    class="button"
                    th:formaction="@{/admin/attendance/csv}"
                    formmethod="get">
              CSV出力
            </button>
          </div>

        </div>
      </form>

      <div class="table-responsive">
        <table class="attendance-table">
          <thead>
            <tr>
              <th class="col-date">日付</th>
              <th class="col-type">社員</th>
              <th class="col-time">出勤</th>
              <th class="col-time">退勤</th>
              <th class="col-time">休憩開始</th>
              <th class="col-time">休憩終了</th>
              <th class="col-type">勤務区分</th>
              <th class="col-place">場所</th>
              <th class="col-status">状態</th>
            </tr>
          </thead>

          <tbody>
            <tr th:each="record : ${allAttendanceRecords}">
              <td class="col-date" th:text="${record.recordDate}"></td>
              <td class="col-type" th:text="${record.userName}"></td>
              <td class="col-time" th:text="${record.checkInTime}"></td>
              <td class="col-time" th:text="${record.checkOutTime}"></td>
              <td class="col-time" th:text="${record.breakStartTime}"></td>
              <td class="col-time" th:text="${record.breakEndTime}"></td>
              <td class="col-type" th:text="${record.workType}"></td>
              <td class="col-place" th:text="${record.location}"></td>
              <td class="col-status" th:text="${record.statusLabel}"></td>
            </tr>

            <tr th:if="${#lists.isEmpty(allAttendanceRecords)}">
              <td colspan="9">勤怠記録がありません。</td>
            </tr>
          </tbody>
        </table>
      </div>

	  <div class="action-row">

	    <a th:href="@{/admin/attendances}" class="button primary">
	      勤怠一覧（残業・週40h・月45h）
	    </a>

	    <!-- 未処理件数バッジ -->
	    <a th:href="@{/admin/fix-requests}" class="button secondary btn-with-badge">
	      修正依頼一覧（未処理）
	      <span class="badge-count"
	            th:if="${pendingFixCount != null and pendingFixCount > 0}"
	            th:text="${pendingFixCount}"></span>
	    </a>

	    <a th:href="@{/admin/users/new}" class="button primary">
	      ユーザー登録
	    </a>

	    <a th:href="@{/admin/users}" class="button secondary">
	      ユーザー一覧
	    </a>

	    <form th:action="@{/logout}" method="post" style="margin:0;">
	      <button type="submit" class="button danger">
	        ログアウト
	      </button>
	    </form>

	  </div>

    </div>
  </th:block>

</div>

</body>
</html>