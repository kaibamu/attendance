<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>修正依頼一覧（全件）</title>
  <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>

<div th:replace="fragments/header :: appHeader('修正依頼一覧（全件）')"></div>
<div th:replace="fragments/layout :: page(~{::content})">
  <th:block th:fragment="content">

  <div class="action-row" style="margin-top: 12px;">

    <a th:href="@{/admin/dashboard}" class="button secondary">
      ← 管理者ダッシュボードへ戻る
    </a>

    <!-- 未処理だけ見る（バッジ付き） -->
    <a th:href="@{/admin/fix-requests}" class="button primary btn-with-badge">
      未処理だけ見る
      <span class="badge-count"
            th:if="${pendingFixCount != null and pendingFixCount > 0}"
            th:text="${pendingFixCount}"></span>
    </a>

    <form th:action="@{/logout}" method="post" style="margin:0;">
      <button type="submit" class="button danger">ログアウト</button>
    </form>

  </div>

      <div class="table-responsive">
        <table class="attendance-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>申請者</th>
              <th>対象日</th>
              <th>理由</th>
              <th>状態</th>
              <th>操作</th>
            </tr>
          </thead>
          <tbody>

            <tr th:if="${#lists.isEmpty(fixRequests)}">
              <td colspan="6">修正依頼はありません</td>
            </tr>

            <tr th:each="req : ${fixRequests}">
              <td th:text="${req.id}"></td>
              <td th:text="${req.user != null ? req.user.username : '-'}"></td>
              <td th:text="${req.attendance != null ? req.attendance.recordDate : '-'}"></td>
              <td th:text="${req.reason}"></td>
              <td>
                <span th:text="${req.status == 'pending' ? '申請中' : (req.status == 'approved' ? '承認済み' : (req.status == 'rejected' ? '却下' : req.status))}"></span>
              </td>

			  <td style="text-align:center;">
			    <!-- pending のときだけボタンを出す -->
			    <div th:if="${req.status == 'pending'}"
			         style="display:flex; gap:10px; justify-content:center; align-items:center;">

			      <form th:action="@{/admin/fix-requests/{id}/approve(id=${req.id})}"
			            method="post" style="margin:0;">
			        <button type="submit"
			                class="button primary"
			                onclick="return confirm('この修正依頼を承認します。よろしいですか？');">
			          承認
			        </button>
			      </form>

			      <form th:action="@{/admin/fix-requests/{id}/reject(id=${req.id})}"
			            method="post" style="margin:0;">
			        <button type="submit"
			                class="button danger"
			                onclick="return confirm('この修正依頼を却下します。よろしいですか？');">
			          却下
			        </button>
			      </form>

			    </div>

			    <!-- pending 以外は操作不可 -->
			    <span th:if="${req.status != 'pending'}">-</span>
			  </td>
            </tr>

          </tbody>
        </table>
      </div>

    </div>

  </th:block>
</div>

</body>
</html>